<% layout('layouts/boilerplate') %>

<div class="container mb-5 mt-4">
  <div class="d-flex justify-content-between align-items-end mb-5">
    <div>
      <span
        class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2 mb-2"
        >Summer 2024 Collection</span
      >
      <h1 class="display-5 fw-bold mb-0">Curated Selection</h1>
      <p class="text-muted m-0">Minimalist picks â€” designed for longevity</p>
    </div>
    <% if (currentUser && currentUser.isAdmin) { %>
    <a href="/products/new" class="btn btn-nova-outline">
      <i class="bi bi-plus-lg me-1"></i> Add Product
    </a>
    <% } %>
  </div>

  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <% products.forEach(product => { %>
    <div class="col">
      <div class="product-card-premium h-100">
        <div class="product-img-wrapper">
          <a href="/products/<%= product._id %>">
            <% if (product.images && product.images.length > 0) { %>
            <img
              src="<%= product.images[0].url %>"
              alt="<%= product.title %>"
              class="main-img"
              onerror="this.src='https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=600&fit=crop'"
            />
            <% } else { %>
            <img
              src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=600&fit=crop"
              alt="No image available"
              class="main-img"
            />
            <% } %>
          </a>
          <div class="product-badge"><%= product.category %></div>
        </div>

        <div class="product-info p-4">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <h5 class="product-title m-0">
              <a
                href="/products/<%= product._id %>"
                class="text-decoration-none text-dark"
              >
                <%= product.title %>
              </a>
            </h5>
            <span class="product-price fw-bold"
              >$<%= product.price.toFixed(2) %></span
            >
          </div>

          <p class="product-desc text-muted small mb-4">
            <%= (product.description || '').substring(0, 75) %>...
          </p>

          <div class="d-flex gap-2">
            <a
              href="/products/<%= product._id %>"
              class="btn btn-nova-dark flex-grow-1"
            >
              View Details
            </a>
            <% if (currentUser) { %>
            <form
              action="/cart/add/<%= product._id %>"
              method="POST"
              class="m-0"
            >
              <button
                class="btn btn-nova-icon"
                type="submit"
                title="Add to Bag"
              >
                <i class="bi bi-bag-plus"></i>
              </button>
            </form>
            <% } %>
          </div>
        </div>
      </div>
    </div>
    <% }) %>
  </div>
</div>

<style>
  /* Product Card Base */
  .product-card-premium {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.05);
    border-radius: 24px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
  }

  .product-card-premium:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
    border-color: rgba(37, 99, 235, 0.2);
  }

  /* Image Effects */
  .product-img-wrapper {
    position: relative;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    background: #f8fafc;
  }

  .main-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
  }

  .product-card-premium:hover .main-img {
    transform: scale(1.08);
  }

  .product-badge {
    position: absolute;
    top: 15px;
    left: 15px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(4px);
    padding: 4px 12px;
    border-radius: 50px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #111827;
  }

  /* Typography */
  .product-title {
    font-size: 1.1rem;
    font-weight: 700;
    letter-spacing: -0.5px;
  }

  .product-price {
    color: var(--brand-primary);
    font-size: 1rem;
  }

  .product-desc {
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Buttons */
  .btn-nova-dark {
    background: #09090b;
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    padding: 10px 20px;
    transition: var(--transition);
  }

  .btn-nova-dark:hover {
    background: #27272a;
    color: white;
  }

  .btn-nova-icon {
    background: #f1f5f9;
    color: #09090b;
    border: none;
    border-radius: 12px;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
  }

  .btn-nova-icon:hover {
    background: var(--brand-primary);
    color: white;
  }

  .btn-nova-outline {
    border: 1.5px solid #e2e8f0;
    background: transparent;
    border-radius: 12px;
    padding: 8px 20px;
    font-weight: 600;
    transition: var(--transition);
  }

  .btn-nova-outline:hover {
    border-color: #09090b;
    background: #09090b;
    color: white;
  }
</style>
